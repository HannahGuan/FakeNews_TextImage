PS C:\Users\Hannah\Desktop\FakeNews_TextImage\BLIP_Model_v2> python3 main.py --classification-type 6_way --mode train --batch-size 8 --lr 0.0001 --dropout 0.3 --pooling mean --epochs 10 --eval-after-train

======================================================================
BLIP-2 FAKE NEWS DETECTION - IMPROVED VERSION
======================================================================

[CONFIG] Device: cuda, Dtype: float16
[CONFIG] Classification: 2_way (2 classes)
[CONFIG] Classifier output classes: 2
[CONFIG] Classification: 6_way (6 classes)

======================================================================
CONFIGURATION SUMMARY
======================================================================
Mode: train
Classification Type: 6_way (6 classes)
Device: cuda
Batch Size: 8
Epochs: 10
Learning Rate: 0.0001
Pooling Strategy: mean
Use Focal Loss: False
Use Scheduler: True
Early Stopping: True (patience=3)
Data Dir: ..\Data
Checkpoint Dir: checkpoints\6_way
======================================================================

[SEED] Random seed set to 42
[1/4] nIitializing BLIP-2...
[BLIP-2] Loading model: Salesforce/blip2-itm-vit-g
[BLIP-2] Device: cuda, Dtype: torch.float16
[BLIP-2] Trainable parameters: 161,825,280 / 1,172,032,258 (13.81%)
[BLIP-2] Model loaded with selective freezing

[2/4] Loading data...

======================================================================
CLASS DISTRIBUTION & WEIGHTS
======================================================================
Class 0:  4384 samples (40.84%) | Weight: 0.4081
Class 1:   576 samples ( 5.37%) | Weight: 3.1062
Class 2:  1907 samples (17.76%) | Weight: 0.9382
Class 3:   185 samples ( 1.72%) | Weight: 9.6712
Class 4:  3259 samples (30.36%) | Weight: 0.5490
Class 5:   424 samples ( 3.95%) | Weight: 4.2197
======================================================================

[DATA] Using stratified split for val/test
[DATA] Train: 10735, Val: 1538, Test: 385

[3/4] Building model...
[MODEL] Input feature dimension: 514
[MODEL] Total parameters: 529,926
[MODEL] Trainable parameters: 529,926
[MODEL] Architecture: 514 -> 512 -> 256 -> 6

[4/4] Training...
Training with:
  - Pooling: mean
  - Loss: Weighted CrossEntropy
  - Optimizer: AdamW (weight_decay=0.01)
  - Scheduler: ReduceLROnPlateau
[TRAINING] Using Weighted Cross-Entropy Loss
[OPTIMIZER] Classifier parameters: 529,926
[OPTIMIZER] BLIP-2 parameters: 0
[OPTIMIZER] Single LR: 0.0001
[SCHEDULER] Using ReduceLROnPlateau (factor=0.5, patience=3)

======================================================================
STARTING TRAINING
======================================================================
Epoch 1 [Train]:   0%|                                                     | 0/1342 [00:00<?, ?it/s]Expanding inputs for image tokens in BLIP-2 should be done in processing. Please follow instruction here (https://gist.github.com/zucchini-nlp/e9f20b054fa322f84ac9311d9ab67042) to update your BLIP-2 model. Using processors without these attributes in the config is deprecated and will throw an error in v4.50.
Epoch 1 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:26<00:00,  2.37it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:19<00:00]
Current LR: 1.00e-04

Epoch 1/10
Train Loss: 5.2448 | Train Acc: 49.96%
Val   Loss: 3.0463 | Val   Acc: 69.90%
[SAVE] Best checkpoint saved to checkpoints\6_way\best_model.pt
[BEST] New best model! Val Acc: 69.90%
Epoch 2 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:21<00:00,  2.39it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:19<00:00]
Current LR: 1.00e-04

Epoch 2/10
Train Loss: 3.5174 | Train Acc: 65.25%
Val   Loss: 2.4296 | Val   Acc: 75.55%
[SAVE] Best checkpoint saved to checkpoints\6_way\best_model.pt
[BEST] New best model! Val Acc: 75.55%
Epoch 3 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:21<00:00,  2.39it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:19<00:00]
Current LR: 1.00e-04

Epoch 3/10
Train Loss: 2.7279 | Train Acc: 69.29%
Val   Loss: 2.3845 | Val   Acc: 75.03%
No improvement for 1 epoch(s)
Epoch 4 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:22<00:00,  2.39it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:20<00:00]
Current LR: 1.00e-04

Epoch 4/10
Train Loss: 2.4812 | Train Acc: 71.93%
Val   Loss: 2.2238 | Val   Acc: 76.40%
[SAVE] Best checkpoint saved to checkpoints\6_way\best_model.pt
[BEST] New best model! Val Acc: 76.40%
Epoch 5 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:23<00:00,  2.38it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:20<00:00]
Current LR: 1.00e-04

Epoch 5/10
Train Loss: 2.0611 | Train Acc: 74.19%
Val   Loss: 2.1414 | Val   Acc: 76.53%
[SAVE] Best checkpoint saved to checkpoints\6_way\best_model.pt
[BEST] New best model! Val Acc: 76.53%
Epoch 6 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:24<00:00,  2.38it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:20<00:00]
Current LR: 1.00e-04

Epoch 6/10
Train Loss: 1.8607 | Train Acc: 75.31%
Val   Loss: 2.1793 | Val   Acc: 76.59%
[SAVE] Best checkpoint saved to checkpoints\6_way\best_model.pt
[BEST] New best model! Val Acc: 76.59%
Epoch 7 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:25<00:00,  2.37it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:20<00:00]
Current LR: 1.00e-04

Epoch 7/10
Train Loss: 1.6895 | Train Acc: 77.84%
Val   Loss: 2.1256 | Val   Acc: 77.05%
[SAVE] Best checkpoint saved to checkpoints\6_way\best_model.pt
[BEST] New best model! Val Acc: 77.05%
Epoch 8 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:24<00:00,  2.38it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:20<00:00]
Current LR: 1.00e-04

Epoch 8/10
Train Loss: 1.4789 | Train Acc: 78.03%
Val   Loss: 2.0029 | Val   Acc: 77.31%
[SAVE] Best checkpoint saved to checkpoints\6_way\best_model.pt
[BEST] New best model! Val Acc: 77.31%
Epoch 9 [Train]: 100%|██████████████████████████████████████████| 1342/1342 [09:23<00:00,  2.38it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:20<00:00]
Current LR: 1.00e-04

Epoch 9/10
Train Loss: 1.4031 | Train Acc: 79.69%
Val   Loss: 2.3009 | Val   Acc: 77.37%
[SAVE] Best checkpoint saved to checkpoints\6_way\best_model.pt
[BEST] New best model! Val Acc: 77.37%
Epoch 10 [Train]: 100%|█████████████████████████████████████████| 1342/1342 [09:23<00:00,  2.38it/s]
Validating: 100%|████████████████████████████████████████████████████████████| 193/193 [01:20<00:00]
Current LR: 1.00e-04

Epoch 10/10
Train Loss: 1.2954 | Train Acc: 80.78%
Val   Loss: 1.8395 | Val   Acc: 76.59%
No improvement for 1 epoch(s)

======================================================================
TRAINING COMPLETE
======================================================================
Best Validation Accuracy: 77.37%
Best Validation Loss: 2.3009
======================================================================

[SAVE] Training history saved to logs\6_way\training_history.png

======================================================================
TRAINING COMPLETE
======================================================================
Best validation accuracy: 77.37%
Final validation accuracy: 76.59%
Model saved to: checkpoints\6_way\best_model.pt
======================================================================

[BONUS] Evaluating on test set...
Evaluating: 100%|███████████████████████████████████████████████████████████████████████████████████████████████████████| 49/49 [00:20<00:00,  2.35it/s]

======================================================================
EVALUATION RESULTS
======================================================================
ACCURACY: 0.5818
PRECISION: 0.7080
RECALL: 0.5818
F1: 0.5676
ROC_AUC: 0.9221
AVERAGE_CONFIDENCE: 0.9110
AVERAGE_ENTROPY: 0.2174

Classification Report:
                  precision    recall  f1-score   support

            Real       0.92      0.44      0.59       148
   Satire/Parody       0.42      0.44      0.43        25
      Misleading       0.77      0.27      0.40        73
        Imposter       0.42      0.62      0.50         8
False Connection       0.54      0.96      0.69       116
     Manipulated       0.26      0.80      0.39        15
     Manipulated       0.26      0.80      0.39        15


        accuracy                           0.58       385
       macro avg       0.55      0.59      0.50       385
    weighted avg       0.71      0.58      0.57       385
    weighted avg       0.71      0.58      0.57       385


[SAVE] Metrics saved to logs\6_way\metrics_6_way.json
[SAVE] Metrics saved to logs\6_way\metrics_6_way.json
[SAVE] Confusion matrix data saved to logs\6_way\confusion_matrix_6_way.json
[SAVE] Confusion matrix data saved to logs\6_way\confusion_matrix_6_way.json

[SAVE] Confusion matrix saved to logs\6_way\confusion_matrix_6_way.png
[SAVE] ROC data saved to logs\6_way\roc_data_6_way.json
[SAVE] ROC curves saved to logs\6_way\roc_curve_6_way.png
[SAVE] Precision-Recall data saved to logs\6_way\pr_data_6_way.json
[SAVE] Precision-Recall curves saved to logs\6_way\pr_curve_6_way.png

[SAVE] Predictions (JSON) saved to logs\6_way\predictions.json

======================================================================
DONE
======================================================================